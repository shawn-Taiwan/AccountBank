*** Settings ***
Library    AppiumLibrary
Library    String
Resource    ../commonVariable.txt

*** Variables ***
${appDefaultLayout} =    xpath=//android.widget.FrameLayout/android.widget.LinearLayout
${addNewTransactionButton} =    xpath=//android.widget.FrameLayout/android.widget.LinearLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.view.View/android.view.View/android.view.View/android.view.View/android.view.View[1]/android.view.View/android.view.View/android.widget.ImageView
${booksButton} =    xpath=//android.widget.ImageView[contains(@content-desc, "Books") and contains(@content-desc, "Tab") and contains(@content-desc, "1")]
${walletButton} =    xpath=//android.widget.ImageView[contains(@content-desc, "Wallet") and contains(@content-desc, "Tab") and contains(@content-desc, "2")]
${analyticsButton} =    xpath=//android.widget.ImageView[contains(@content-desc, "Analytics") and contains(@content-desc, "Tab") and contains(@content-desc, "3")]
${settingsButton} =    xpath=//android.widget.ImageView[contains(@content-desc, "Settings") and contains(@content-desc, "Tab") and contains(@content-desc, "4")]

*** Keywords ***
Wait Until Default View Is Visible
    Wait Until Element Is Visible On Page    ${appDefaultLayout}

Open Account Bank
    Open Application    remote_url=${appium_server}    platformName=android    udid=emulator-5554    appPackage=${packageName}    appActivity=${appActivity}
    Wait Until Default View Is Visible

Click Element On Page
    [Arguments]    ${locator}
    Wait Until Element Is Visible On Page    ${locator}
    Click Element    ${locator}

Wait Until Element Is Visible On Page
    [Arguments]    ${locator}
    Wait Until Page Contains Element    ${locator}    timeout=${shortPeriodOfTime}    error=Element should be contain.
    Wait Until Element Is Visible    ${locator}    timeout=${shortPeriodOfTime}    error=Element should be visible.

Wait Until Elements Are Visible On Page
    [Arguments]    @{locators}
    FOR    ${locator}    IN    @{locators}
        Wait Until Element Is Visible On Page    ${locator}
    END

Wait Until Expense View Is Visible
    ${dietIcon} =    Set Variable    xpath=//android.widget.ImageView[@content-desc="diet"]
    ${diaryIcon} =    Set Variable    xpath=//android.widget.ImageView[@content-desc="daily"]
    @{elements} =     Create List    ${dietIcon}    ${diaryIcon}
    Wait Until Elements Are Visible On Page    @{elements}

Wait Until Income View Is Visible
    ${wageIcon} =    Set Variable    xpath=//android.widget.ImageView[@content-desc="wage"]
    ${bonusIcon} =    Set Variable    xpath=//android.widget.ImageView[@content-desc="bonus"]
    @{elements} =     Create List    ${wageIcon}    ${bonusIcon}
    Wait Until Elements Are Visible On Page    @{elements}

Wait Until Add New Transaction View Is Visible
    ${inputTextField} =    Set Variable    xpath=//android.widget.FrameLayout/android.widget.LinearLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.view.View/android.view.View/android.view.View/android.view.View/android.widget.EditText
    Wait Until Element Is Visible On Page    ${inputTextField}

Open New Transaction View
    Click Element On Page    ${addNewTransactionButton}
    Wait Until Expense View Is Visible
    Wait Until Add New Transaction View Is Visible

Select Income On New Transaction View
    ${incomeIcon} =    Set Variable    //android.view.View[@content-desc="Income"]
    Wait Until Element Is Visible On Page    ${incomeIcon}
    Click Element On Page    ${incomeIcon}
    Wait Until Income View Is Visible

Choose Type On New Transaction View
    [Arguments]    ${type}
    ${typeView} =    Set Variable    xpath=//android.widget.FrameLayout/android.widget.LinearLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.view.View/android.view.View/android.view.View/android.view.View/android.view.View[2]/android.view.View/android.view.View/android.view.View/android.view.View
    ${typeIcon} =    Set Variable    xpath=//android.widget.ImageView[@content-desc="${type}"]
    Scroll    ${typeIcon}    ${typeView}
    Click Element On Page    ${typeIcon}

Click Digital Button On New Transaction View
    [Arguments]    ${digital}
    ${digitalButton} =    Set Variable    xpath=//android.widget.Button[@content-desc="${digital}"]
    Click Element On Page    ${digitalButton}

Input Amount On New Transaction View
    [Arguments]    ${amount}    ${account}=default account    ${unit}=USD
    ${amountField} =    Set Variable    //android.view.View[@content-desc="${account}(${unit})${amount}"]
    @{digitals} =    Split String To Characters    ${amount}
    FOR    ${digital}    IN    @{digitals}
        Click Digital Button On New Transaction View    ${digital}
    END
    Wait Until Element Is Visible On Page    ${amountField}

Click OK Button On New Transaction View
    ${okButton} =    Set Variable    xpath=//android.widget.FrameLayout/android.widget.LinearLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.view.View/android.view.View/android.view.View/android.view.View/android.view.View[5]/android.view.View/android.view.View[4]/android.widget.ImageView
    Click Element On Page    ${okButton}

Default View Should Be Visible
    Wait Until Default View Is Visible

Transaction Should Be Visible On Default View
    [Arguments]    ${type}    ${amount}    ${from}=myself    ${account}=default account
    ${transactionInfo} =    Set Variable    xpath=//android.widget.ImageView[contains(@content-desc, '${type}') and contains(@content-desc, '${amount}') and contains(@content-desc, '${from}') and contains(@content-desc, '${account}')]
    Wait Until Element Is Visible On Page    ${transactionInfo}

Wait Until Add New Book View Is Visible
    ${addBookButtonOnNewBookView} =    Set Variable    xpath=//android.view.View[@content-desc="+Add"]
    Wait Until Element Is Visible On Page    ${addBookButtonOnNewBookView}

Wait Until Wallet View Is Visible
    ${cashText} =    Set Variable    xpath=//android.view.View[@content-desc="Cash"]
    Wait Until Element Is Visible On Page    ${cashText}

Go To Wallet View
    Click Element On Page    ${walletButton}
    Wait Until Wallet View Is Visible

Wait Until Analytics View Is Visible
    ${titleText} =    Set Variable    xpath=//android.view.View[@content-desc="Analytics"]
    Wait Until Element Is Visible On Page    ${titleText}

Go To Analytics View
    Click Element On Page    ${analyticsButton}
    Wait Until Analytics View Is Visible

Wait Until Settings View Is Visible
    ${languageIcon} =    Set Variable    xpath=//android.widget.ImageView[@content-desc="Language"]
    ${themeSettingsIcon} =    Set Variable    xpath=//android.widget.ImageView[@content-desc="Theme Settings"]
    ${periodicBillIcon} =    Set Variable    xpath=//android.widget.ImageView[@content-desc="Periodic bill"]
    @{elements} =     Create List    ${languageIcon}    ${themeSettingsIcon}    ${periodicBillIcon}
    Wait Until Elements Are Visible On Page    @{elements}

Go To Settings View
    Click Element On Page    ${settingsButton}
    Wait Until Settings View Is Visible

Click Accounts On Settings View
    ${accountsIcon} =    Set Variable    xpath=//android.widget.ImageView[@content-desc="Accounts"]
    ${accountTitle} =    Set Variable    xpath=//android.view.View[@content-desc="Accounts"]
    Click Element On Page    ${accountsIcon}
    Wait Until Element Is Visible On Page    ${accountTitle}

Select Account On Accounts View
    [Arguments]    ${accountName}
    ${accountLabel} =    Set Variable    xpath=//android.widget.ImageView[@content-desc="${accountName}"]
    ${accountEditView} =    Set Variable    xpath=//android.view.View[@content-desc="Edit Account"]
    Click Element On Page    ${accountLabel}
    Wait Until Element Is Visible On Page    ${accountEditView}

Change Currency
    [Arguments]    ${currency}
    ${defaultCurrencyIcon} =    Set Variable    xpath=//android.widget.ImageView[contains(@content-desc, "American dollar(USD)")]
    ${newCurrencyIcon} =    Set Variable    xpath=//android.view.View[contains(@content-desc, "${currency}")]
    Click Element On Page    ${defaultCurrencyIcon}
    #TODO check?
    Click Element On Page    ${newCurrencyIcon}

Currency Should Be
    [Arguments]    ${currency}
    ${currencyText} =    Set Variable    xpath=//android.widget.ImageView[contains(@content-desc, "${currency}")]
    Wait Until Element Is Visible On Page    ${currencyText}

Change Member
    [Arguments]    ${member}
    ${memberButton} =    Set Variable    xpath=//android.widget.FrameLayout/android.widget.LinearLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.view.View/android.view.View/android.view.View/android.view.View/android.view.View[5]/android.view.View/android.view.View[1]/android.widget.ImageView
    ${wifeButton} =    Set Variable    xpath=//android.widget.ImageView[@content-desc="${member}"]
    ${memberChooseTitle} =    Set Variable    xpath=//android.view.View[@content-desc="member choose"]
    Click Element On Page    ${memberButton}
    Wait Until Element Is Visible On Page    ${memberChooseTitle}
    Click Element On Page    ${wifeButton}

Change Date
    ${dateButton} =    Set Variable    //android.widget.Button[@content-desc="TODAY"]
    ${penButton} =    Set Variable    //android.widget.Button[@content-desc="Switch to input"]
    ${date} =    Set Variable    //android.view.View[contains(@content-desc, "1,")]
    ${okButton} =    Set Variable    //android.widget.Button[@content-desc="OK"]
    ${nowDateButton} =    Set Variable    //android.widget.Button[contains(@content-desc, "/01")]
    Click Element On Page    ${dateButton}
    Wait Until Element Is Visible On Page    ${penButton}
    Click Element On Page    ${date}
    Click Element On Page    ${okButton}
    Wait Until Element Is Visible On Page    ${nowDateButton}

Click Equal Button On Transaction View
    ${equalButton} =    Set Variable    xpath=//android.widget.FrameLayout/android.widget.LinearLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.view.View/android.view.View/android.view.View/android.view.View/android.view.View[5]/android.view.View/android.view.View[4]/android.widget.ImageView
    Click Element On Page    ${equalButton}

Number On View Should Be
    [Arguments]    ${amount}    ${account}=default account    ${unit}=USD
    ${amountField} =    Set Variable    //android.view.View[@content-desc="${account}(${unit})${amount}"]
    Wait Until Element Is Visible On Page    ${amountField}

Switch To Calendar View
    ${calendarButton} =    Set Variable    xpath=//android.view.View[@content-desc="Calendar"]
    # ${calendarImage} =    Set Variable    
    Click Element On Page    ${calendarButton}
    #TODO check calendar is visible

Change View To Week, 2Weeks, Month
    ${changeToWeek} =    Set Variable    //android.view.View[@content-desc="Month"]
    ${changeTo2Week} =    Set Variable    //android.view.View[@content-desc="Week"]
    ${changeToMonth} =    Set Variable    //android.view.View[@content-desc="2 Weeks"]
    Click Element On Page    ${changeToWeek}
    Click Element On Page    ${changeTo2Week}
    Click Element On Page    ${changeToMonth}

Click Transaction
    [Arguments]    ${type}    ${amount}    ${from}=myself    ${account}=default account
    ${transaction} =    Set Variable    xpath=//android.widget.ImageView[contains(@content-desc, '${type}') and contains(@content-desc, '${amount}') and contains(@content-desc, '${from}') and contains(@content-desc, '${account}')]
    ${editPanButton} =     Set Variable    xpath=//android.widget.ImageView[contains(@content-desc, '${type}') and contains(@content-desc, '${amount}') and contains(@content-desc, '${from}') and contains(@content-desc, '${account}')]/android.widget.Button[3]
    Click Element On Page    ${transaction}
    Wait Until Element Is Visible On Page    ${editPanButton}

Edit Transaction Type
    [Arguments]    ${newType}    ${type}    ${amount}    ${from}=myself    ${account}=default account
    ${editPanButton} =     Set Variable    xpath=//android.widget.ImageView[contains(@content-desc, '${type}') and contains(@content-desc, '${amount}') and contains(@content-desc, '${from}') and contains(@content-desc, '${account}')]/android.widget.Button[3]
    Click Transaction    ${type}    ${amount}    ${from}    ${account}
    Click Element On Page    ${editPanButton}
    Wait Until Add New Transaction View Is Visible
    Choose Type On New Transaction View    type=${newType}
    Click OK Button On New Transaction View

Click Expense Analysis On Default View
    ${expenseText} =    Set Variable    xpath=//android.view.View[contains(@content-desc, "Expenses") and (not(contains(@content-desc, ":")))]
    ${expenseAnalysisTitle} =    Set Variable    xpath=//android.view.View[@content-desc="Expense"]
    ${analysisDropdown} =     Set Variable    xpath=//android.view.View[contains(@content-desc, 'Show') and contains(@content-desc, 'menu') and contains(@content-desc, 'By') and contains(@content-desc, 'Category')]
    Click Element On Page    ${expenseText}
    Wait Until Elements Are Visible On Page    ${expenseAnalysisTitle}    ${analysisDropdown}

Click Income Analysis
    &{incomeIcon} =    Create Dictionary    x=730    y=473
    ${incomeAnalysisTitle} =    Set Variable    xpath=//android.view.View[contains(@content-desc, "Income")]
    ${analysisDropdown} =     Set Variable    xpath=//android.view.View[contains(@content-desc, 'Show') and contains(@content-desc, 'menu') and contains(@content-desc, 'By') and contains(@content-desc, 'Category')]
    Click Element At Coordinates    ${incomeIcon}[x]    ${incomeIcon}[y]
    Wait Until Elements Are Visible On Page    ${incomeAnalysisTitle}    ${analysisDropdown}

Analysis Figure Should Be Visible
    ${analysisFigure} =    Set Variable    xpath=//android.widget.FrameLayout/android.widget.LinearLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.view.View/android.view.View/android.view.View/android.view.View/android.view.View/android.view.View[2]/android.view.View[2]
    Wait Until Element Is Visible On Page    ${analysisFigure}

Expense Analysis Should Be Visible
    Analysis Figure Should Be Visible

Income Analysis Should Be Visible
    Analysis Figure Should Be Visible

Go To Books View
    Click Element On Page    ${booksButton}
    Wait Until Wallet View Is Visible

Open New Account View
    ${addButton} =    Set Variable    xpath=//android.view.View[@content-desc="+Add"]
    ${newAccountLabel} =    Set Variable    xpath=//android.view.View[@content-desc="New Account"]
    Click Element On Page    ${addButton}
    Wait Until Element Is Visible On Page    ${newAccountLabel}

Choose Account Type
    [Arguments]    ${type}
    ${typeLabel} =    Set Variable    xpath=//android.widget.ImageView[contains(@content-desc, '${type}')]
    ${editView} =    Set Variable    xpath=//android.view.View[contains(@content-desc, "Create") and contains(@content-desc, '${type}')]
    Click Element On Page    ${typeLabel}
    Wait Until Element Is Visible On Page    ${editView}

Input New Account Name
    [Arguments]    ${name}
    # ${nameTextField} =    Set Variable    xpath=//android.widget.FrameLayout/android.widget.LinearLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.widget.FrameLayout/android.view.View/android.view.View/android.view.View/android.view.View/android.view.View[2]/android.view.View/android.widget.ImageView[1]
    ${nameTextField} =    Set Variable    xpath=//android.widget.EditText[contains(@content-desc, 'Account Name')]
    # Click Element On Page    ${nameTextField}
    # Set
    Input Text    ${nameTextField}    ${name}

Add A New Account
    [Arguments]    ${name}=newAccount    ${type}=Cash    ${balance}=1000    ${currency}=${EMPTY}    ${icon}=${EMPTY}    ${note}=${EMPTY}
    Click Accounts On Settings View
    Open New Account View
    Choose Account Type    ${type}
    Input New Account Name    ${name}
    # Input New Account Balance    ${balance}
    # Choose New Account Currency    ${currency}
    # Choose New Account Icon    ${icon}
    # Input New Account Note    ${note}
    # Save
    # Wait Until Elements